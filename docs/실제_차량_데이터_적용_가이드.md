# 실제 차량 데이터 적용 가이드

차량 이미지, 가격, 제원 등 **실제 데이터**를 넣어서 대시보드를 만드는 방법입니다.

---

## 0. 이미지 연동 (초기 권장)

차량 사진을 **직접 호스팅하기 부담스러울 때**는 아래처럼 외부 URL을 쓰면 됩니다.

- **각 자동차 브랜드 공식 홈페이지**  
  현대·기아·제네시스·BMW·벤츠 등 보도자료/미디어에서 제공하는 **이미지 URL**을 그대로 연결.  
  (URL이 오래 유지되는지 확인 후 사용.)
- **Unsplash**  
  [Unsplash 자동차 이미지](https://unsplash.com/images/things/car) 등 **무료·저작권 허용** 이미지 URL 사용.  
  현재 프로젝트는 차종(세단/SUV)·연료(전기 등)에 따라 Unsplash 이미지를 사용하도록 되어 있습니다.

이미지 호스팅이 준비되면 `lib/car-data.ts` 의 `image` 값을 `/images/xxx.jpg` 또는 공식 URL로 바꾸면 됩니다.

---

## 1. 데이터가 필요한 항목 (스키마 기준)

| 항목 | 설명 | 예시 |
|------|------|------|
| 이미지 | 차량 사진 URL | 고해상도 정식 이미지 |
| 가격 | 국내 신차 가격 (만원) | 5030 (= 5,030만 원) |
| 브랜드/모델명 | 공식 표기 | 현대, IONIQ 5 |
| 차종/연료 | 제원 | SUV, 전기 |
| 연비·마력·배기량 | 스펙 | efficiency, horsepower, displacement |
| AI 점수 (5가지) | 가격·연비·디자인·공간·안전 1~10점 | DB 또는 추후 Gemini로 산출 |

---

## 2. 데이터 구하는 방법

### (1) 이미지 – 실차 사진

**방법 A: 제조사 보도자료/프레스킷 (권장)**  
- 현대·기아·제네시스: [현대저널](https://www.hyundaijournal.com/), [기아 보도자료](https://www.kia.com/kr/company/press-release)  
- 수입차: BMW Press, Mercedes-Benz Media 등 각사 미디어 사이트  
- 고해상도 이미지를 **다운로드** 후 `public/images/` 에 저장하거나,  
  보도자료 페이지의 **이미지 URL**이 장기 유지되면 그 URL을 DB/데이터에 넣기  

**방법 B: 무료/저작권 허용 사진**  
- [Unsplash](https://unsplash.com/s/photos/car) – "car", "hyundai", "tesla" 등 검색  
- [Wikimedia Commons](https://commons.wikimedia.org/) – 자동차 카테고리  
- 사용 시 **저작권·라이선스** 확인 후, 출처 표기 필요하면 표기  

**방법 C: 자동차 정보 사이트**  
- 카눈, 카위키, 다나와 자동차 등은 **이미지 URL**을 그대로 쓰면 저작권·URL 변경 이슈가 있을 수 있으므로,  
  가능하면 **직접 다운로드 후 우리 서버/CDN에 올려서** 사용하는 편이 안전합니다.

**정리:**  
- **실제 차량 이미지** = 제조사 보도자료 다운로드 → `public/images/차량ID.jpg` 저장 → 데이터의 `image` 필드에 `/images/차량ID.jpg` 입력  
- 외부 URL을 쓸 경우: 해당 URL이 **장기 유지**되는지, **상업적 이용 허용**인지 반드시 확인.

---

### (2) 가격 – 국내 신차 시세

**방법 A: 공식 홈페이지에서 수동 정리 (가장 정확)**  
- [현대차](https://www.hyundai.com/kr/ko/e/vehicles/price) – 모델별 가격  
- [기아](https://www.kia.com/kr/vehicles/ev6/price.html) – 차량별 가격  
- [제네시스](https://www.genesis.com/kr/ko/models/g80.html)  
- 테슬라: [테슬라 코리아](https://www.tesla.com/ko_kr) – 모델별 가격  
- 수입차: BMW/벤츠/아우디 등 한국 법인 또는 대리점 공식 가격표  

**방법 B: 자동차 견적/가격 사이트**  
- [카눈](https://www.carnoon.co.kr/), [다나와 자동차](https://auto.danawa.com/), [차프라이스](https://chaprice.co.kr/) 등  
- 트림별 가격을 확인한 뒤, **대표 트림 1개**를 골라 만원 단위로 데이터에 넣기 (예: 5,030만 원 → `5030`)

**방법 C: API (있는 경우)**  
- 국내에서 “신차 공식 가격”을 공개 API로 주는 곳은 많지 않음.  
- 있다면 해당 API 응답을 가공해 `price`(만원), `model_name` 등에 매핑하면 됨.

**정리:**  
- **실제 가격** = 공식 사이트 또는 신뢰할 수 있는 가격 사이트에서 **트림별 가격 확인** → 만원 단위 숫자로 정리 (예: 5,030만 원 → `5030`).

---

### (3) 제원 (연비, 마력, 배기량 등)

- 동일하게 **제조사 공식 사이트** 또는 **카눈/다나와** 등에서  
  연비(km/L 또는 km/kWh), 마력(hp), 배기량(cc) 등을 확인 후  
  `efficiency`, `horsepower`, `displacement` 등에 넣기.

---

## 3. 데이터를 “어디에” 넣을지

### 옵션 A: 코드/JSON에 직접 (현재 방식)

- `lib/car-data.ts` 의 `cars` 배열을 **실제 데이터**로 교체.
- 이미지는 `public/images/` 에 파일 넣고 `image: "/images/ioniq5.jpg"` 형태로 지정.
- 가격·제원은 검색해서 나온 **실제 숫자**로 수정.
- **장점:** 별도 서버 없이 바로 반영. **단점:** 차량 추가/수정할 때마다 코드 수정 필요.

### 옵션 B: Supabase DB (권장 – 장기 운영)

- 이미 만들어 둔 **Supabase DDL** (`supabase-ddl.sql`)대로 테이블 생성.
- `cars` 테이블에 **실제 이미지 URL**, **실제 가격(만원)**, 제원 등 입력.
- 프론트는 `car-data.ts` 대신 **Supabase 클라이언트**로 `cars` 테이블 조회.
- **장점:** 나중에 관리자 페이지나 스프레드시트 연동으로 수정 가능. **단점:** Supabase 설정 및 연동 코드 필요.

### 옵션 C: CSV/스프레드시트 → DB 또는 코드

- 엑셀/Google 시트에 컬럼: `brand`, `model_name`, `price`, `image_url`, `fuel_type`, `category`, `efficiency`, `horsepower` …
- 실제 데이터를 여기에 채운 뒤:
  - **Supabase 사용 시:** CSV import 또는 API로 한 번에 insert.
  - **코드 사용 시:** CSV를 JSON으로 변환 후 `car-data.ts` 의 `cars` 배열을 이 JSON으로 교체.

---

## 4. 추천 작업 순서

1. **이미지**  
   - 제조사 보도자료 또는 Unsplash/저작권 허용 사진에서 **차량별 이미지** 수집.  
   - `public/images/` 에 저장하거나, 안정적인 외부 URL 확보.

2. **가격**  
   - 현대/기아/제네시스/테슬라/수입차 공식 또는 카눈·다나와에서 **트림별 가격** 확인.  
   - 대표 트림 1개씩 골라 **만원 단위**로 정리 (예: 5,030만 원 → 5030).

3. **제원**  
   - 같은 출처에서 연비, 마력, 배기량, 차종, 연료 타입 등 정리.

4. **데이터 반영**  
   - **Supabase 쓸 경우:** `cars` 테이블에 위 데이터 insert.  
   - **코드만 쓸 경우:** `lib/car-data.ts` 의 `cars` 배열을 위 데이터로 교체.

5. **프론트 연동**  
   - Supabase를 쓰면 `createClient`로 `from('cars').select()` 해서 화면에 표시.  
   - 이미지 필드는 `image_url`(또는 사용하는 컬럼명) 그대로 `<Image src={car.image_url} />` 로 사용.

---

## 5. 주의사항

- **저작권:** 이미지는 제조사 보도자료(이용 조건 확인) 또는 라이선스가 명확한 곳에서만 사용.
- **가격:** 시장 상황에 따라 변경되므로, “기준일”과 “트림”을 메모해 두고 주기적으로 갱신하는 것이 좋음.
- **이미지 URL:** 외부 URL을 쓰면 나중에 삭제/변경될 수 있으므로, 가능하면 우리가 호스팅하는 경로(`/images/...`) 사용을 권장.

이 순서대로 하면 **실제 있는 데이터**만으로 이미지·가격·제원을 채워 기능을 만들 수 있습니다.  
Supabase 연동 코드 예시가 필요하면 “Supabase에서 cars 불러와서 화면에 쓰는 코드” 요청해 주세요.

---

## 6. 실제 데이터 전환 (MVP 완성 후): 공공데이터포털 API

MVP(최소 기능 제품)가 완성되면, **공공데이터포털 API**를 연결해 **한국 시장 제원 데이터**를 실시간으로 불러오도록 업데이트할 수 있습니다.

### 사용 API

| API | 용도 | 링크 |
|-----|------|------|
| **한국에너지공단_자동차 표시연비 목록 조회 서비스** | 모델별 연비·제원 목록 (약 2,800개 이상) | [공공데이터포털 15139827](https://www.data.go.kr/data/15139827/openapi.do) |
| **한국에너지공단_자동차 표시연비 정보** (파일) | CSV 다운로드로 연비·등급 등 일괄 보유 | [15083023](https://www.data.go.kr/data/15083023/fileData.do) |
| **국토교통부_자동차종합정보** | 차량등록번호·소유주 기준 개별 차량 제원 조회 | [15071233](https://www.data.go.kr/data/15071233/openapi.do) |

### 적용 방법

1. **공공데이터포털 회원가입**  
   [data.go.kr](https://www.data.go.kr) → 회원가입·로그인

2. **활용신청**  
   위 표의 “자동차 표시연비 목록 조회 서비스” 등 원하는 API 선택 → 활용신청 → **서비스키(인증키)** 발급

3. **환경변수 설정**  
   프로젝트 루트에 `.env.local` 생성 후:
   ```env
   DATA_GO_KR_SERVICE_KEY=발급받은_서비스키
   ```
   (참고: `.env.example` 에 변수명이 정리되어 있음.)

4. **실시간 제원 사용**  
   - **API 라우트:** `GET /api/cars/public`  
     - `lib/public-data-api.ts` 가 공공데이터 API를 호출하고, 응답을 정리해 반환합니다.  
     - 서비스키가 설정되어 있으면 연비·모델명·제조사 등 제원 목록을 JSON으로 받을 수 있습니다.  
   - **프론트에서 사용:**  
     - 현재는 `lib/car-data.ts` 의 로컬 `cars` 를 사용합니다.  
     - 실시간 제원으로 전환할 때는 `fetch('/api/cars/public')` 로 목록을 가져온 뒤,  
       기존 `cars` 와 **모델명/제조사 기준으로 매칭**해 연비 등만 갱신하거나, 공공데이터 목록을 주 데이터 소스로 쓰도록 수정하면 됩니다.

5. **API URL**  
   공공데이터 상세 페이지의 **Swagger(활용 명세)** 에서 실제 요청 URL·파라미터를 확인할 수 있습니다.  
   서비스마다 경로가 다를 수 있으므로, 필요 시 `lib/public-data-api.ts` 의 `ENERGY_EFFICIENCY_API_BASE` 등을 Swagger 명세에 맞게 수정하면 됩니다.

이렇게 하면 **한국 시장 제원**을 공공데이터 기준으로 실시간 반영할 수 있습니다.

---

## 7. 다나와 신차 목록 HTML로 가져오기

다나와 자동차 신차 목록 페이지의 **HTML을 복사**해 붙여넣으면, 이미지·가격·제원을 파싱해 CarInsight 형식으로 변환할 수 있습니다.

### 사용 방법

1. [다나와 자동차 신차 목록](https://auto.danawa.com/newcar/) 등에서 원하는 조건으로 검색합니다.
2. 페이지에서 **전체 HTML**을 복사합니다. (예: 개발자 도구에서 `.contents` 또는 목록이 포함된 영역의 상위 요소 선택 후 Copy → Copy outerHTML)
3. 대시보드에서 **「다나와 신차 목록 HTML로 가져오기」**를 펼친 뒤, 텍스트 영역에 HTML을 붙여넣고 **가져오기**를 누릅니다.
4. 파싱된 차량 목록이 즉시 화면에 반영됩니다. **「기본 목록으로 되돌리기」**로 원래 데이터로 복구할 수 있습니다.

### API

- **POST /api/cars/import-danawa**  
  - Body: `{ "html": "..." }` (application/json) 또는 HTML 문자열 (text/html)  
  - 응답: `{ success: true, count: N, data: Car[] }`

### 왜 28~30대만 나오나요? (다나와 300대 vs 앱 28대)

다나와 신차 검색은 **한 페이지에 약 30대씩**만 보여주고, 아래쪽에 **페이지 번호(1, 2, 3, … 13 등)**로 나뉩니다.  
브라우저에서 **현재 보고 있는 한 페이지만** HTML로 복사하면, 그 1페이지분만 저장되는 것이므로 **약 28~30대**만 파싱됩니다.  
**전체 300대 이상**을 쓰려면 **각 페이지 HTML을 모두 저장**한 뒤, 아래 “여러 페이지 합치기”대로 실행하면 됩니다.

### 기본 데이터로 저장해 두고 쓰기 (파일 기반)

1. 다나와 신차 검색 페이지에서 **현재 페이지의 HTML**을 복사한 뒤,  
   - 1페이지만 쓸 때: `data/danawa-sample.html` 에 저장  
   - 여러 페이지 쓸 때: `data/danawa-page1.html`, `data/danawa-page2.html`, … 처럼 **페이지마다 파일 하나씩** 저장
2. 프로젝트 루트에서 다음을 실행합니다.  
   `npx tsx scripts/parse-danawa.ts`  
   - `danawa-sample.html` 만 있으면 → 그 1페이지만 파싱 (약 30대)  
   - `danawa-page1.html`, `danawa-page2.html`, … 도 있으면 → **전부 파싱해서 합친 뒤** `lib/danawa-default-cars.json` 에 저장 (300대+ 가능)
3. `lib/default-cars.ts` 가 이 JSON을 읽어 `defaultCars`로 export하므로, 앱은 **저장된 목록 전체**를 기본 차량 데이터로 사용합니다.

### 2페이지(또는 N페이지) 전체 반영하기

다나와는 차량 목록을 **JavaScript로 불러오기** 때문에, 주소만 요청해 받은 HTML에는 목록이 없습니다.  
**브라우저에서 페이지를 연 뒤**, 아래 순서로 하면 2페이지 전체(약 30대)를 한 번에 넣을 수 있습니다.

1. **2페이지 열기**  
   [다나와 신차 검색 2페이지](https://auto.danawa.com/newcar/?Work=search&listSortType=3&tab=all&listCount=30&page=2) 를 브라우저에서 엽니다. 목록이 **다 로드될 때까지** 기다립니다.
2. **목록 HTML 복사**  
   - 목록 아무 차량 위에서 **우클릭 → 검사**(개발자 도구)  
   - 왼쪽 Elements에서 **`<ul class="list modelList">`** 를 찾습니다. (또는 "modelList"로 검색)  
   - 그 **`ul`** 에서 우클릭 → **Copy → Copy outerHTML**
3. **파일로 저장**  
   - 복사한 내용을 `data/page2-paste.html` 같은 파일로 저장합니다. (이름은 자유)
4. **2페이지용 파일로 넣기**  
   터미널에서:
   ```bash
   cd car-insight-dashboard-ui
   node scripts/set-danawa-page2.js data/page2-paste.html
   ```
5. **파서 실행**  
   ```bash
   npx tsx scripts/parse-danawa.ts
   ```
   - 1페이지(`danawa-sample.html`) 30대 + 2페이지 약 30대가 합쳐져, **중복 제외** 후 `lib/danawa-default-cars.json` 에 저장됩니다.

### 3페이지(또는 N페이지) 반영하기

2페이지와 같은 방식으로, **다른 페이지**의 목록도 추가할 수 있습니다.

1. **해당 페이지 열기**  
   다나와 신차 검색에서 원하는 페이지(예: 3페이지)를 브라우저로 열고, 목록이 **다 로드될 때까지** 기다립니다.
2. **목록 HTML 복사**  
   - 목록 아무 차량 위에서 **우클릭 → 검사**  
   - Elements에서 **`<ul class="list modelList">`** 를 찾아 그 **`ul`** 에서 우클릭 → **Copy → Copy outerHTML**  
   - 또는 해당 목록이 포함된 **상위 영역 전체**를 복사해도 됩니다.
3. **paste 파일에 저장**  
   - 복사한 내용을 `data/danawa-paste3.html` 에 붙여넣어 저장합니다. (기존 안내 주석는 지우고 HTML만 넣어도 됩니다.)
4. **한 번에 적용 (권장)**  
   터미널에서:
   ```bash
   cd car-insight-dashboard-ui
   npm run apply-danawa
   ```
   - `data/danawa-paste3.html`에 목록 HTML이 있으면 3페이지 추출 후, **기존(sample, page2) + page3** 을 합쳐 `lib/danawa-default-cars.json` 을 갱신합니다.
   - paste3에 내용이 없어도 기존 데이터만으로 JSON을 다시 만들어 UI에 반영됩니다.
   - 수동으로 하려면: `node scripts/set-danawa-page3.js data/danawa-paste3.html` → `npx tsx scripts/parse-danawa.ts`

이때 다음이 **같은 데이터 기준**으로 동작합니다.

- **좌측 사이드바**  
  차종, 국산/수입 브랜드, 연료 타입, 라이프스타일 옵션은 **실제 차량 목록에서 추린 값**만 표시됩니다.
- **인기 랭킹 Top 5**  
  `viewCount`가 있으면 그 순으로, 없으면 **가격 낮은 순** 상위 5대로 막대 차트가 구성됩니다.
- **AI 전략 추천**  
  예산·연료·라이프스타일 필터에 맞는 차량을 **현재 차량 목록** 기준으로 추천합니다.

파서(`lib/danawa-parser.ts`)에는 동풍, KGM, 쎄보모빌리티, SMART EV, 디피코, 마이브, 제이스모빌리티, BYD, 쉐보레 등 브랜드 매핑이 포함되어 있어, 위 방식으로 저장한 HTML에서 해당 브랜드도 정상 파싱됩니다.

### 주의

- 크롤링 대상 사이트의 **이용약관·저작권**을 확인하고, 개인/교육용 또는 허가 범위 내에서 사용하세요.
- 다나와 이미지 URL(`autoimg.danawa.com`)은 외부 도메인이므로, `next.config.mjs`의 `images.remotePatterns`에 이미 등록되어 있습니다.
